<script type="text/javascript">
    /* global App */
    TradeJs = {
	init:function(){
	    
	    //App.loadWindow('page/trade/document',{doc_id:8});
	    //App.loadModule('page/trade/document_list');
	    
	    App.initTabs('trade_main_tabs');
	},
	selectCompany:function(company){
	    if( company.company_id*1 ){
		$.post('Company/selectPassiveCompany/' + company.company_id,function(xhr){
		    App.pcomp=App.json(xhr);
		    App.handler.notify('passiveCompanySelected');
		});		
	    }
	}
    };
</script>
<div style="float:left;padding-right: 3px;vertical-align: top">
    <div class="transp60" style="min-width:150px;padding:5px;">
	<input class="easyui-combobox" data-options="
	    valueField: 'company_id',
	    textField: 'label',
	    loader:function(param,success,error){
		$.get('Company/listFetch/selected_passive_if_empty',param,function(xhr){
		    var resp=App.json(xhr);
		    success(resp[0]?resp:[]);
		});
	    },
	    mode: 'remote',
	    method:'get',
	    width:150,
	    onSelect: TradeJs.selectCompany
	    ">
	<ul class="easyui-tree " data-options="
	    url:'Company/branchFetch/',
	    method:'get',
	    loadFilter:function(data){
		for(var i in data){
		    data[i].id=data[i].branch_id;
		    data[i].text=data[i].label;
		    if(data[i].level!=0){
			data[i].iconCls='icon-lock';
		    }
		}
		return data;
	    },
	    onSelect:function(node){
		if(node.state=='closed')
		    $(this).tree('expand',node.target);
		else
		    TradeJs.selectCompany(node);
	    },
	    animate:true,
	    dnd:true">
	</ul>
    </div>
</div>
<div id="trade_main_tabs" style="min-width:1111px;max-width:60%">
    <div title="Документы" href="page/trade/document_list.html" style="min-height: 500px;"></div>
    <div title="Настройки" href="page/catalog/company_prefs.html" style="min-height: 500px;"></div>
</div>
    <div title="Реквизиты" href="page/catalog/company_details.html" style="min-height: 500px; display: none;"></div>
