<script>
    /* global App,DetAcomp */
    PrefJs={
	init:function(){
	    this.initDetails();
	    this.initPrefs();
	},
	initDetails:function(){
	    var data={
		company_id:App.user.props.active_company_id,
		inline:true,
		is_active:true
	    };
	    App.loadModule('page/company/details',data,'DetAcomp',/(Cdet|page_company_details)([^\w]|_)/g,"DetAcomp$2");
	},
	initPrefs:function(){
	    $.get("Pref/getPrefs/",function(text){
		PrefJs.prefData=App.json(text);
		App.setupForm('#AcompPrefs',PrefJs.prefData).change(function(){
		    var node=this;
		    PrefJs.updateField(node.name,node.value,node.title);
		});
	    });
	},
	initClientbankFields:function(){
	    
	},
	updateField:function(field,value,title){
	    $.post('Pref/setPrefs/'+App.uri(field,value),function(ok){
		if( ok*1 ){
		    PrefJs.prefData[field]=value;
		    App.flash("Сохранено: " + title);
		} else {
		    App.flash("Сохраненние не удалось: " + title);
		}
	    });
	}
    };
</script>
<div class="easyui-panel" title="Настройки" style="width:920px;padding: 3px;margin-bottom: 2px">
    <form id="AcompPrefs">
	<div class="inp_group" style="width:340px;">
	    <input name="usd_ratio" title="Курс доллара">
	    <input name="default_debt_limit" title="Лимит долга">
	</div>
	<div class="inp_group" style="width:340px;">
	    Поля в файле .csv клиент банка
	    <table id="AcompPrefs_cbdg" class="easyui-datagrid">
		
	    </table>
	</div>
	<div class="inp_group" style="width:340px;">
	    <input name="director_name" title="Руководитель ФИО">
	    <input name="director_tin" title="Руководитель ИНН">
	    <input name="accountant_name" title="Бухгалтер ФИО">
	    <input name="accountant_tin" title="Бухгалтер ИНН">
	</div>
    </form>    
</div>

<div id="DetAcomp"></div>


<style>
    #AcompPrefs b{
	width:120px;
    }
</style>






<!--
<div data-dojo-type="dijit/layout/ContentPane">
    <form data-dojo-type="dijit/form/Form" id="pref_ratio_form" style="width:550px;display: inline-block">
	<div data-dojo-type="dijit/TitlePane" data-dojo-props="open:1" title="Курсы валют к основной валюте">
	    <table border="0">
		<tr>
		    <td align="right">USD</td>
		    <td>
			<input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.prefUpdate(this);" style="width:50px" name="usd_ratio" />
		    </td>
		    <td>
			<iframe src="http://plustrade.com.ua/dollar.php" width="70" height="30" frameborder="0"></iframe>
		    </td>
		</tr>
	    </table>
	</div>
	<div data-dojo-type="dijit/TitlePane" data-dojo-props="open:1" title="Дополнительные настройки">
	    </fieldset>
	    <fieldset>
		<legend>Клиент банк</legend>
                <table border="0">
                    <tr>
                        <td align="right">Поля в файле .csv клиент банка:</td>
                        <td>
                            <textarea data-dojo-type="dijit/form/SimpleTextarea" onchange="PrefJs.prefUpdate(this);" name="clientbank_fields" style="width:300px;" rows="1"></textarea>
                        </td>
                    </tr>
                </table>
	    </fieldset>
	</div>
    </form>        
    <div data-dojo-type="dijit/TitlePane" data-dojo-props="open:1" title="Пользователи" style="width:820px;display: inline-block;vertical-align: top">
        <div data-dojo-type="dijit/form/Form" id="prefUserDetails" style="vertical-align: top;">
            <div id="prefUserList" style="display: inline-block;vertical-align: top;" class="hidden">
                {%for user in users%}
                <div class="{%ifequal forloop.counter0 index%}blue_grad{%else%}light_grad{%endifequal%}" style="margin:3px;padding:3px;height: 25px;cursor:pointer;display: inline-block;width:200px;" onclick="PrefJs.userSelect('{{forloop.counter0}}');">
                    <img src="img/user.png"> <b>{{user.user_login|default:'-'}}</b> {{user.last_name|default:''}} {{user.first_name|default:''}}
                </div>
                {%endfor%}
                <div>
                    <img src="img/edit_add_small.gif" onclick="PrefJs.userAdd();">
                    <img src="img/edit_delete_small.gif" onclick="PrefJs.userDelete();">
                </div>
            </div>

            <fieldset style="max-width: 350px;display: inline-block;vertical-align: top;">
                <legend>Настройки пользователя</legend>
                <div class="formBox">
                    <div class="formLabel">Логин:</div>
                    <input data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="regExp:'[a-zA-Z0-9_]{3,10}'" onchange="PrefJs.userUpdate(this);" name="user_login" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Уровень доступа:</div>
                    <select data-dojo-type="dijit/form/Select" onchange="PrefJs.userUpdate(this);" name="user_level">
                        <option value="0">Нет доступа</option>
                        <option value="1">Ограниченный</option>
                        <option value="2">Менеджер</option>
                        <option value="3">Бухгалтер</option>
                        <option value="4">Администратор</option>
                    </select>
                </div>
                <div data-dojo-type="dijit/TitlePane" data-dojo-props="open:0" title="Изменить пароль">
                    <div class="formBox">
                        <div class="formLabel">Действующий пароль:</div>
                        <input data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="regExp:'[a-zA-Z0-9_]{4,10}'" type="password" name="curr_pass" />
                    </div>
                    <div class="formBox">
                        <div class="formLabel">Новый пароль:</div>
                        <input data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="regExp:'[a-zA-Z0-9_]{4,10}'" type="password" name="new_pass1" />
                    </div>
                    <div class="formBox">
                        <div class="formLabel">Новый пароль повтор:</div>
                        <input data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="regExp:'[a-zA-Z0-9_]{4,10}'" type="password" name="new_pass2" />
                    </div>
                    <div style="text-align: center;">
                        <button data-dojo-type="dijit/form/Button" onclick="PrefJs.changePass();">Изменить пароль</button>
                    </div>
                </div>
                <div class="formBox">
                    <div class="formLabel">Path to assigned branch:</div>
                    <textarea data-dojo-type="dijit/form/Textarea" style="width:200px;" onchange="PrefJs.userUpdate(this)" name="user_assigned_path"></textarea>
                </div>
                <div class="formBox">
                    <div class="formLabel">Path to assigned stat:</div>
                    <textarea data-dojo-type="dijit/form/Textarea" style="width:200px;" onchange="PrefJs.userUpdate(this)" name="user_assigned_stat"></textarea>
                </div>
                <div class="formBox">
                    <div class="formLabel">Permissions:</div>
                    <textarea data-dojo-type="dijit/form/Textarea" style="width:200px;" onchange="PrefJs.userUpdate(this);" name="user_permissions"></textarea>
                </div>
            </fieldset>
            <fieldset style="max-width: 700px;display: inline-block;vertical-align: top;">
                <legend>Данные персонала</legend>
                <div class="formBox">
                    <div class="formLabel">Фамилия:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="last_name" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Имя:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="first_name" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Отчество:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="middle_name" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Подпись ФИО:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="user_sign" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Должность:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="user_position" />
                </div>
                <hr size="1">
                <div class="formBox">
                    <div class="formLabel">Документ:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="id_type" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Серия:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="id_serial" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Номер:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="id_number" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Дата выдачи:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="id_date" />
                </div>
                <div class="formBox">
                    <div class="formLabel">Выдан:</div>
                    <input data-dojo-type="dijit/form/TextBox" onchange="PrefJs.userUpdate(this);" name="id_given_by" />
                </div>
            </fieldset>
        </div> 
    </div>

    <div data-dojo-type="dijit/TitlePane" data-dojo-props="open:1" title="Управление резервными копиями" style="display: inline-block;vertical-align: top">
	<button onclick="App.loadWindow('page/dialog/backup');">Запустить менеджер</button>
    </div>
</div>

-->